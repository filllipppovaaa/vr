<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Robot Animations Control</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º model-viewer —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ -->
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer-effects@1.2.0/dist/model-viewer-effects.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
    }

    #controls {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(30, 30, 40, 0.9);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      color: white;
      backdrop-filter: blur(5px);
      border: 1px solid #444;
    }

    #controls h3 {
      margin: 0 0 15px 0;
      color: #ffaa00;
    }

    #debug-info {
      margin-top: 15px;
      padding: 10px;
      background: #222;
      border-radius: 6px;
      font-size: 12px;
      border-left: 3px solid #ffaa00;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    button {
      margin: 0;
      padding: 10px 16px;
      cursor: pointer;
      background: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background: #444;
      border-color: #ffaa00;
    }

    button.active {
      background: #ffaa00;
      color: #222;
      border-color: #ffaa00;
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #1a1a1a;
    }
  </style>
</head>

<body>

<div id="controls">
  <h3>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º</h3>
  
  <div class="button-group">
    <button id="btn1">üé¨ –ê–Ω–∏–º–∞—Ü–∏—è 1 (–¢—Ä–µ–∫ –ù–õ–ê)</button>
    <button id="btn2">üö∂ –ê–Ω–∏–º–∞—Ü–∏—è 2 (holding_and_walk)</button>
  </div>
  
  <div class="button-group">
    <button id="outlineBtn">‚ú® –ö–æ–Ω—Ç—É—Ä (–æ–±–≤–æ–¥–∫–∞)</button>
    <button id="pixelBtn">üî≤ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
  </div>
  
  <div id="debug-info">
    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status" style="color: #ffaa00;">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
    <div><strong>–ê–Ω–∏–º–∞—Ü–∏–∏:</strong> <span id="anim-list">–¢—Ä–µ–∫ –ù–õ–ê, holding_and_walk</span></div>
    <div><strong>–≠—Ñ—Ñ–µ–∫—Ç—ã:</strong> <span id="effects-status">‚ùå –ù–µ –∞–∫—Ç–∏–≤–Ω—ã</span></div>
  </div>
</div>

<!-- model-viewer —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ -->
<model-viewer
  id="mv"
  src="robot.glb"
  camera-controls
  autoplay
  animation-crossfade-duration="300"
  ar-status="not-present"
  loading="eager"
  reveal="auto"
  shadow-intensity="1"
  tone-mapping="aces"
  exposure="1.2"
  style="background-color: #1a1a1a;"
>

  <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ –∏ –∏–º–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã -->
  <effect-composer multisampling="4">
    <!-- –≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ç—É—Ä–∞ (outline) - –æ–±–≤–æ–¥–∫–∞ –º–æ–¥–µ–ª–∏ -->
    <outline-effect
      id="outlineEffect"
      color="#ff6600"
      strength="2.5"
      threshold="0.1"
      blend-mode="additive"
    ></outline-effect>
    
    <!-- –≠—Ñ—Ñ–µ–∫—Ç –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏ -->
    <pixelate-effect
      id="pixelEffect"
      granularity="6"
      blend-mode="normal"
      opacity="0.9"
    ></pixelate-effect>
  </effect-composer>

  <!-- –û—Å–≤–µ—â–µ–Ω–∏–µ -->
  <environment-preset></environment-preset>
  <directional-light intensity="1.5" shadow-intensity="1"></directional-light>
  <ambient-light intensity="0.8"></ambient-light>

</model-viewer>

<script>
(() => {
  console.log('üöÄ Script started');
  
  const mv = document.getElementById('mv');
  const btn1 = document.getElementById('btn1');
  const btn2 = document.getElementById('btn2');
  const outlineBtn = document.getElementById('outlineBtn');
  const pixelBtn = document.getElementById('pixelBtn');
  const statusSpan = document.getElementById('status');
  const animListSpan = document.getElementById('anim-list');
  const effectsStatusSpan = document.getElementById('effects-status');

  let animations = [];
  let outlineEffect = null;
  let pixelEffect = null;

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  function findEffects() {
    if (mv.shadowRoot) {
      // –ò—â–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ —Ç–µ–Ω–µ–≤–æ–º DOM
      outlineEffect = mv.shadowRoot.querySelector('outline-effect');
      pixelEffect = mv.shadowRoot.querySelector('pixelate-effect');
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—â–µ–º –ø–æ ID
    if (!outlineEffect) outlineEffect = document.getElementById('outlineEffect');
    if (!pixelEffect) pixelEffect = document.getElementById('pixelEffect');
    
    console.log('üîç Found effects:', { outlineEffect, pixelEffect });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    if (outlineEffect || pixelEffect) {
      effectsStatusSpan.innerHTML = '‚úÖ –ù–∞–π–¥–µ–Ω—ã';
    }
    
    return outlineEffect || pixelEffect;
  }

  // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–Ω–æ–ø–æ–∫
  function updateButtonStates() {
    if (outlineEffect) {
      const isActive = outlineEffect.blendMode !== 'skip' && outlineEffect.style?.display !== 'none';
      if (isActive) {
        outlineBtn.classList.add('active');
      } else {
        outlineBtn.classList.remove('active');
      }
    }
    
    if (pixelEffect) {
      const isActive = pixelEffect.blendMode !== 'skip' && pixelEffect.style?.display !== 'none';
      if (isActive) {
        pixelBtn.classList.add('active');
      } else {
        pixelBtn.classList.remove('active');
      }
    }
  }

  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  mv.addEventListener('load', () => {
    console.log('‚úÖ Model loaded successfully');
    statusSpan.textContent = '–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
    statusSpan.style.color = '#00ff00';
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    try {
      animations = mv.availableAnimations || [];
      console.log('üìä Available animations:', animations);
      animListSpan.textContent = animations.join(', ');
      
      if (animations.length >= 1) {
        mv.animationName = animations[0];
        mv.play();
      }
    } catch (e) {
      console.error('Error getting animations:', e);
    }
    
    // –ò—â–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
    setTimeout(() => {
      findEffects();
      updateButtonStates();
      
      // –ü—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∞
      if (outlineEffect) {
        console.log('üé® Outline effect found, testing activation');
        outlineEffect.blendMode = 'additive';
        outlineEffect.strength = 3;
      }
    }, 1000);
  });

  mv.addEventListener('error', (error) => {
    console.error('‚ùå Model loading error:', error);
    statusSpan.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    statusSpan.style.color = '#ff0000';
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 1
  btn1.addEventListener('click', () => {
    if (animations.length >= 1) {
      mv.animationName = animations[0];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[0]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 2
  btn2.addEventListener('click', () => {
    if (animations.length >= 2) {
      mv.animationName = animations[1];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[1]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Ç—É—Ä–∞ (–æ–±–≤–æ–¥–∫–∞)
  outlineBtn.addEventListener('click', () => {
    // –ù–∞—Ö–æ–¥–∏–º —ç—Ñ—Ñ–µ–∫—Ç –µ—Å–ª–∏ –µ—â—ë –Ω–µ –Ω–∞—à–ª–∏
    if (!outlineEffect) findEffects();
    
    if (outlineEffect) {
      try {
        if (outlineEffect.blendMode === 'skip') {
          // –í–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç—É—Ä
          outlineEffect.blendMode = 'additive';
          outlineEffect.strength = 3;
          outlineEffect.color = '#ff6600';
          outlineBtn.classList.add('active');
          effectsStatusSpan.innerHTML = '‚ú® –ö–æ–Ω—Ç—É—Ä –∞–∫—Ç–∏–≤–µ–Ω';
          console.log('üü† Outline ENABLED');
        } else {
          // –í—ã–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç—É—Ä
          outlineEffect.blendMode = 'skip';
          outlineBtn.classList.remove('active');
          effectsStatusSpan.innerHTML = '‚úÖ –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞–π–¥–µ–Ω—ã';
          console.log('‚ö™ Outline DISABLED');
        }
      } catch (e) {
        console.error('Error toggling outline:', e);
      }
    } else {
      console.log('‚ùå Outline effect not found');
      effectsStatusSpan.innerHTML = '‚ùå –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω';
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  pixelBtn.addEventListener('click', () => {
    // –ù–∞—Ö–æ–¥–∏–º —ç—Ñ—Ñ–µ–∫—Ç –µ—Å–ª–∏ –µ—â—ë –Ω–µ –Ω–∞—à–ª–∏
    if (!pixelEffect) findEffects();
    
    if (pixelEffect) {
      try {
        if (pixelEffect.blendMode === 'skip') {
          // –í–∫–ª—é—á–∞–µ–º –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—é
          pixelEffect.blendMode = 'normal';
          pixelEffect.granularity = 8;
          pixelEffect.opacity = 1;
          pixelBtn.classList.add('active');
          effectsStatusSpan.innerHTML = 'üî≤ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞';
          console.log('üî≥ Pixelation ENABLED');
        } else {
          // –í—ã–∫–ª—é—á–∞–µ–º –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—é
          pixelEffect.blendMode = 'skip';
          pixelBtn.classList.remove('active');
          effectsStatusSpan.innerHTML = '‚úÖ –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞–π–¥–µ–Ω—ã';
          console.log('‚¨ú Pixelation DISABLED');
        }
      } catch (e) {
        console.error('Error toggling pixelation:', e);
      }
    } else {
      console.log('‚ùå Pixel effect not found');
      effectsStatusSpan.innerHTML = '‚ùå –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω';
    }
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
  setInterval(() => {
    if (!outlineEffect || !pixelEffect) {
      findEffects();
    }
  }, 2000);

  // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ shadowRoot
  setTimeout(() => {
    if (mv.shadowRoot) {
      console.log('üé≠ Shadow root –¥–æ—Å—Ç—É–ø–µ–Ω');
    } else {
      console.log('‚ùå Shadow root –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω');
    }
  }, 1500);

})();
</script>

</body>
</html>
