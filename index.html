<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Robot Animations Control</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º model-viewer —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ -->
  <script type="module" src="https://unpkg.com/@google/model-viewer@4.0.0/dist/model-viewer.min.js"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer-effects@2.0.0/dist/model-viewer-effects.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f2f2f2;
    }

    #controls {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    #debug-info {
      margin-top: 10px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      max-width: 300px;
    }

    button {
      margin: 5px;
      padding: 8px 16px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      font-weight: bold;
    }

    button:hover {
      background: #45a049;
    }

    button.active {
      background: #ff5722;
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #e0e0e0;
    }
  </style>
</head>

<body>

<div id="controls">
  <h3>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º</h3>
  <button id="btn1">–ê–Ω–∏–º–∞—Ü–∏—è 1</button>
  <button id="btn2">–ê–Ω–∏–º–∞—Ü–∏—è 2</button>
  <button id="outlineBtn">üî≤ –ö–æ–Ω—Ç—É—Ä</button>
  <button id="pixelBtn">üî≥ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
  
  <div id="debug-info">
    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
    <div><strong>–ê–Ω–∏–º–∞—Ü–∏–∏:</strong> <span id="anim-list">–Ω–µ—Ç</span></div>
  </div>
</div>

<!-- model-viewer —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ -->
<model-viewer
  id="mv"
  src="robot.glb"
  camera-controls
  autoplay
  animation-crossfade-duration="0"
  ar-status="not-present"
  loading="eager"
  reveal="auto"
  tone-mapping="aces"
  shadow-intensity="1"
  environment-image="neutral"
>

  <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞ model-viewer -->
  <effect-composer>
    <!-- –ö–æ–Ω—Ç—É—Ä (outline) -->
    <outline-effect
      id="outlineEffect"
      color="orange"
      strength="3"
      blend-mode="screen"
    ></outline-effect>
    
    <!-- –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è -->
    <pixelate-effect
      id="pixelEffect"
      granularity="8"
      blend-mode="normal"
      opacity="1"
    ></pixelate-effect>
  </effect-composer>

  <!-- –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–µ -->
  <directional-light intensity="1" shadow-intensity="1"></directional-light>
  <ambient-light intensity="0.5"></ambient-light>

</model-viewer>

<script>
(() => {
  console.log('Script started');
  
  const mv = document.getElementById('mv');
  const btn1 = document.getElementById('btn1');
  const btn2 = document.getElementById('btn2');
  const outlineBtn = document.getElementById('outlineBtn');
  const pixelBtn = document.getElementById('pixelBtn');
  const statusSpan = document.getElementById('status');
  const animListSpan = document.getElementById('anim-list');

  let animations = [];

  // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–Ω–æ–ø–æ–∫
  function updateButtons() {
    if (outlineEffect) {
      if (outlineEffect.blendMode !== 'skip') {
        outlineBtn.classList.add('active');
      } else {
        outlineBtn.classList.remove('active');
      }
    }
    
    if (pixelEffect) {
      if (pixelEffect.blendMode !== 'skip') {
        pixelBtn.classList.add('active');
      } else {
        pixelBtn.classList.remove('active');
      }
    }
  }

  // –ü–æ–ª—É—á–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  let outlineEffect, pixelEffect;
  
  mv.addEventListener('load', () => {
    console.log('‚úÖ Model loaded successfully');
    statusSpan.textContent = '–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
    statusSpan.style.color = 'green';
    
    // –ü–æ–ª—É—á–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–∑ model-viewer
    setTimeout(() => {
      // –ò—â–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–Ω—É—Ç—Ä–∏ model-viewer
      const effects = mv.querySelectorAll('outline-effect, pixelate-effect');
      console.log('Found effects:', effects.length);
      
      effects.forEach(effect => {
        if (effect.tagName === 'OUTLINE-EFFECT') {
          outlineEffect = effect;
          console.log('Outline effect found');
        } else if (effect.tagName === 'PIXELATE-EFFECT') {
          pixelEffect = effect;
          console.log('Pixelate effect found');
        }
      });
      
      updateButtons();
    }, 500);
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    try {
      animations = mv.availableAnimations || [];
      console.log('Available animations:', animations);
      animListSpan.textContent = animations.length ? animations.join(', ') : '–Ω–µ—Ç –∞–Ω–∏–º–∞—Ü–∏–π';
      
      if (animations.length >= 1) {
        mv.animationName = animations[0];
        mv.play();
        console.log('Playing animation:', animations[0]);
      }
    } catch (e) {
      console.error('Error getting animations:', e);
      animListSpan.textContent = '–æ—à–∏–±–∫–∞';
    }
  });

  mv.addEventListener('error', (error) => {
    console.error('‚ùå Model loading error:', error);
    statusSpan.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    statusSpan.style.color = 'red';
  });

  mv.addEventListener('progress', (event) => {
    const progress = event.detail?.totalProgress || 0;
    if (progress < 1) {
      statusSpan.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞: ${Math.round(progress * 100)}%`;
    }
  });

  // –ö–Ω–æ–ø–∫–∞ 1
  btn1.addEventListener('click', () => {
    if (animations.length >= 1) {
      mv.animationName = animations[0];
      mv.currentTime = 0;
      mv.play();
      console.log('Switched to animation:', animations[0]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ 2
  btn2.addEventListener('click', () => {
    if (animations.length >= 2) {
      mv.animationName = animations[1];
      mv.currentTime = 0;
      mv.play();
      console.log('Switched to animation:', animations[1]);
    }
  });

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞
  outlineBtn.addEventListener('click', () => {
    if (outlineEffect) {
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º blendMode –º–µ–∂–¥—É 'screen' –∏ 'skip'
      if (outlineEffect.blendMode === 'skip') {
        outlineEffect.blendMode = 'screen';
        outlineEffect.strength = 3;
        outlineBtn.classList.add('active');
        console.log('üü† Outline enabled');
      } else {
        outlineEffect.blendMode = 'skip';
        outlineBtn.classList.remove('active');
        console.log('‚ö™ Outline disabled');
      }
    } else {
      console.log('Outline effect not found');
    }
  });

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  pixelBtn.addEventListener('click', () => {
    if (pixelEffect) {
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º blendMode –º–µ–∂–¥—É 'normal' –∏ 'skip'
      if (pixelEffect.blendMode === 'skip') {
        pixelEffect.blendMode = 'normal';
        pixelEffect.granularity = 8;
        pixelBtn.classList.add('active');
        console.log('üî≤ Pixelation enabled');
      } else {
        pixelEffect.blendMode = 'skip';
        pixelBtn.classList.remove('active');
        console.log('‚¨ú Pixelation disabled');
      }
    } else {
      console.log('Pixel effect not found');
    }
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  setTimeout(() => {
    if (!outlineEffect || !pixelEffect) {
      console.log('Searching for effects again...');
      outlineEffect = document.getElementById('outlineEffect');
      pixelEffect = document.getElementById('pixelEffect');
      console.log('Effects by ID:', { outlineEffect, pixelEffect });
      updateButtons();
    }
  }, 2000);

})();
</script>

</body>
</html>
