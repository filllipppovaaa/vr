<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Robot Animations Control</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º model-viewer –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–∏–º–µ—Ä–µ -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.1/dist/es-module-shims.js"></script>
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@^0.172.0/build/three.module.min.js"
    }
  }
  </script>

  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer-module.min.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer-effects/dist/model-viewer-effects.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f7;
      overflow: hidden;
    }

    #controls {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      color: #333;
      backdrop-filter: blur(5px);
      border: 1px solid #e0e0e0;
      pointer-events: none;
    }

    #controls h3 {
      margin: 0 0 15px 0;
      color: #ff5500;
    }

    #controls button {
      pointer-events: auto;
    }

    #debug-info {
      margin-top: 15px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 6px;
      font-size: 12px;
      border-left: 3px solid #ff5500;
      color: #333;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    button {
      margin: 0;
      padding: 10px 16px;
      cursor: pointer;
      background: #ffffff;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    button:hover {
      background: #f8f8f8;
      border-color: #ff5500;
    }

    button.active {
      background: #ff5500;
      color: white;
      border-color: #ff5500;
    }

    #click-hint {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff5500;
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: bold;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4);
      animation: pulse 2s infinite;
      border: 2px solid white;
      font-size: 18px;
      letter-spacing: 1px;
    }

    @keyframes pulse {
      0% { transform: translateX(-50%) scale(1); box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4); }
      50% { transform: translateX(-50%) scale(1.05); box-shadow: 0 8px 30px rgba(255, 85, 0, 0.6); }
      100% { transform: translateX(-50%) scale(1); box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4); }
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #ffffff;
      cursor: pointer;
      --progress-bar-color: #ff5500;
      --progress-bar-height: 4px;
    }

    model-viewer:active {
      cursor: grabbing;
    }
  </style>
</head>

<body>

<div id="controls">
  <h3>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º</h3>
  
  <div class="button-group">
    <button id="btn1">üé¨ –ê–Ω–∏–º–∞—Ü–∏—è 1 (–¢—Ä–µ–∫ –ù–õ–ê)</button>
    <button id="btn2">üö∂ –ê–Ω–∏–º–∞—Ü–∏—è 2 (holding_and_walk)</button>
  </div>
  
  <div class="button-group">
    <button id="outlineBtn">‚ú® –ö–æ–Ω—Ç—É—Ä (–≤–∫–ª/–≤—ã–∫–ª)</button>
    <button id="pixelBtn">üî≤ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
  </div>
  
  <div id="debug-info">
    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status" style="color: #ff5500;">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
    <div><strong>–ê–Ω–∏–º–∞—Ü–∏–∏:</strong> <span id="anim-list">–¢—Ä–µ–∫ –ù–õ–ê, holding_and_walk</span></div>
    <div><strong>–†–µ–∂–∏–º:</strong> <span id="click-mode">üëÜ –ö–ª–∏–∫–Ω–∏ –ø–æ —Ä–æ–±–æ—Ç—É</span></div>
  </div>
</div>

<div id="click-hint">
  üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –ö–†–ê–°–ù–´–ô –ö–û–ù–¢–£–†!
</div>

<model-viewer
  id="mv"
  src="robot.glb"
  camera-controls
  autoplay
  animation-crossfade-duration="300"
  shadow-intensity="1"
  exposure="1"
  auto-rotate
  style="background-color: #ffffff;"
>

  <effect-composer id="composer">
    <outline-effect id="outlineEffect" color="red" blend-mode="skip"></outline-effect>
    <pixelate-effect id="pixelEffect" granularity="6" blend-mode="skip"></pixelate-effect>
  </effect-composer>

</model-viewer>

<script>
(() => {
  console.log('üöÄ Script started');
  
  const mv = document.getElementById('mv');
  const btn1 = document.getElementById('btn1');
  const btn2 = document.getElementById('btn2');
  const outlineBtn = document.getElementById('outlineBtn');
  const pixelBtn = document.getElementById('pixelBtn');
  const statusSpan = document.getElementById('status');
  const animListSpan = document.getElementById('anim-list');
  const clickModeSpan = document.getElementById('click-mode');
  const clickHint = document.getElementById('click-hint');

  const outlineEffect = document.getElementById('outlineEffect');
  const pixelEffect = document.getElementById('pixelEffect');

  let animations = [];
  let isOutlineActive = false;

  console.log('Effects found:', { outlineEffect, pixelEffect });

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞ (–∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–∏–º–µ—Ä–µ)
  function toggleOutline() {
    if (outlineEffect) {
      if (isOutlineActive) {
        outlineEffect.setAttribute('blend-mode', 'skip');
        isOutlineActive = false;
        outlineBtn.classList.remove('active');
        clickHint.innerHTML = 'üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –ö–†–ê–°–ù–´–ô –ö–û–ù–¢–£–†!';
        clickHint.style.background = '#ff5500';
        clickModeSpan.innerHTML = 'üëÜ –ö–ª–∏–∫–Ω–∏ –ø–æ —Ä–æ–±–æ—Ç—É';
        console.log('üî¥ Outline OFF');
      } else {
        outlineEffect.setAttribute('blend-mode', 'default');
        isOutlineActive = true;
        outlineBtn.classList.add('active');
        clickHint.innerHTML = '‚úÖ –ö–û–ù–¢–£–† –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!';
        clickHint.style.background = '#00aa00';
        clickModeSpan.innerHTML = '‚ú® –ö—Ä–∞—Å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä –∞–∫—Ç–∏–≤–µ–Ω';
        console.log('üü¢ Outline ON');
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  function togglePixel() {
    if (pixelEffect) {
      if (pixelEffect.getAttribute('blend-mode') === 'skip') {
        pixelEffect.setAttribute('blend-mode', 'default');
        pixelBtn.classList.add('active');
        console.log('üì∑ Pixel ON');
      } else {
        pixelEffect.setAttribute('blend-mode', 'skip');
        pixelBtn.classList.remove('active');
        console.log('üì∑ Pixel OFF');
      }
    }
  }

  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  mv.addEventListener('load', () => {
    console.log('‚úÖ Model loaded successfully');
    statusSpan.textContent = '–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
    statusSpan.style.color = '#00aa00';
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    try {
      animations = mv.availableAnimations || [];
      console.log('üìä Available animations:', animations);
      animListSpan.textContent = animations.join(', ');
      
      if (animations.length >= 1) {
        mv.animationName = animations[0];
        mv.play();
      }
    } catch (e) {
      console.error('Error getting animations:', e);
    }
  });

  mv.addEventListener('error', (error) => {
    console.error('‚ùå Model loading error:', error);
    statusSpan.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    statusSpan.style.color = '#ff0000';
  });

  // –ö–õ–ò–ö –ü–û –†–û–ë–û–¢–£ - –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ç—É—Ä
  mv.addEventListener('click', () => {
    console.log('üëÜ Robot clicked!');
    toggleOutline();
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 1
  btn1.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 1) {
      mv.animationName = animations[0];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[0]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 2
  btn2.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 2) {
      mv.animationName = animations[1];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[1]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Ç—É—Ä–∞
  outlineBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleOutline();
  });

  // –ö–Ω–æ–ø–∫–∞ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  pixelBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    togglePixel();
  });

  // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
  window.debug = {
    outlineOn: () => outlineEffect?.setAttribute('blend-mode', 'default'),
    outlineOff: () => outlineEffect?.setAttribute('blend-mode', 'skip'),
    pixelOn: () => pixelEffect?.setAttribute('blend-mode', 'default'),
    pixelOff: () => pixelEffect?.setAttribute('blend-mode', 'skip'),
    effects: { outlineEffect, pixelEffect }
  };

})();
</script>

</body>
</html>
