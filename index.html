<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Robot Animations Control</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer-effects@1.2.0/dist/model-viewer-effects.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f7;
      overflow: hidden;
    }

    #controls {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      color: #333;
      backdrop-filter: blur(5px);
      border: 1px solid #e0e0e0;
      pointer-events: none;
    }

    #controls h3 {
      margin: 0 0 15px 0;
      color: #ff5500;
    }

    #controls button {
      pointer-events: auto;
    }

    #debug-info {
      margin-top: 15px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 6px;
      font-size: 12px;
      border-left: 3px solid #ff5500;
      color: #333;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    button {
      margin: 0;
      padding: 10px 16px;
      cursor: pointer;
      background: #ffffff;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    button:hover {
      background: #f8f8f8;
      border-color: #ff5500;
    }

    button.active {
      background: #ff5500;
      color: white;
      border-color: #ff5500;
    }

    #click-hint {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff5500;
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: bold;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4);
      animation: pulse 2s infinite;
      border: 2px solid white;
      font-size: 18px;
      letter-spacing: 1px;
    }

    @keyframes pulse {
      0% { transform: translateX(-50%) scale(1); box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4); }
      50% { transform: translateX(-50%) scale(1.05); box-shadow: 0 8px 30px rgba(255, 85, 0, 0.6); }
      100% { transform: translateX(-50%) scale(1); box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4); }
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #ffffff;
      cursor: pointer;
      --progress-bar-color: #ff5500;
      --progress-bar-height: 4px;
    }

    model-viewer:active {
      cursor: grabbing;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç—É—Ä–∞ */
    .outline-demo {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 85, 0, 0.9);
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-size: 14px;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      border: 1px solid white;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .outline-demo span {
      display: inline-block;
      width: 20px;
      height: 20px;
      background: #ff5500;
      border: 3px solid white;
      border-radius: 50%;
      box-shadow: 0 0 15px #ff5500;
    }
  </style>
</head>

<body>

<div class="outline-demo">
  <span></span> –ö–æ–Ω—Ç—É—Ä –±—É–¥–µ—Ç –û–†–ê–ù–ñ–ï–í–´–ú
</div>

<div id="controls">
  <h3>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º</h3>
  
  <div class="button-group">
    <button id="btn1">üé¨ –ê–Ω–∏–º–∞—Ü–∏—è 1 (–¢—Ä–µ–∫ –ù–õ–ê)</button>
    <button id="btn2">üö∂ –ê–Ω–∏–º–∞—Ü–∏—è 2 (holding_and_walk)</button>
  </div>
  
  <div class="button-group">
    <button id="outlineBtn">‚ú® –ö–æ–Ω—Ç—É—Ä (–≤–∫–ª/–≤—ã–∫–ª)</button>
    <button id="pixelBtn">üî≤ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
    <button id="testOutlineBtn" style="background: #ff5500; color: white;">üî• –¢–ï–°–¢ –ö–û–ù–¢–£–†–ê</button>
  </div>
  
  <div id="debug-info">
    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status" style="color: #ff5500;">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
    <div><strong>–ê–Ω–∏–º–∞—Ü–∏–∏:</strong> <span id="anim-list">–¢—Ä–µ–∫ –ù–õ–ê, holding_and_walk</span></div>
    <div><strong>–†–µ–∂–∏–º:</strong> <span id="click-mode">üëÜ –ö–ª–∏–∫–Ω–∏ –ø–æ —Ä–æ–±–æ—Ç—É</span></div>
  </div>
</div>

<div id="click-hint">
  üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –Ø–†–ö–ò–ô –û–†–ê–ù–ñ–ï–í–´–ô –ö–û–ù–¢–£–†!
</div>

<model-viewer
  id="mv"
  src="robot.glb"
  camera-controls
  autoplay
  animation-crossfade-duration="300"
  ar-status="not-present"
  loading="eager"
  reveal="auto"
  shadow-intensity="0.5"
  tone-mapping="commerce"
  exposure="1.5"
  style="background-color: #ffffff;"
  environment-image="neutral"
>

  <effect-composer multisampling="8">
    <!-- –≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ç—É—Ä–∞ - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ó–ê–ú–ï–¢–ù–´–ô -->
    <outline-effect
      id="outlineEffect"
      color="#ff3300"
      strength="8"
      threshold="0.01"
      blend-mode="screen"
      pulse="true"
    ></outline-effect>
    
    <!-- –≠—Ñ—Ñ–µ–∫—Ç –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏ -->
    <pixelate-effect
      id="pixelEffect"
      granularity="6"
      blend-mode="skip"
      opacity="1"
    ></pixelate-effect>
  </effect-composer>

  <!-- –ú—è–≥–∫–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ —Ñ–æ–Ω–∞ -->
  <environment-preset></environment-preset>
  <directional-light intensity="1.2" shadow-intensity="0.5"></directional-light>
  <ambient-light intensity="0.8"></ambient-light>

</model-viewer>

<script>
(() => {
  console.log('üöÄ Script started');
  
  const mv = document.getElementById('mv');
  const btn1 = document.getElementById('btn1');
  const btn2 = document.getElementById('btn2');
  const outlineBtn = document.getElementById('outlineBtn');
  const pixelBtn = document.getElementById('pixelBtn');
  const testOutlineBtn = document.getElementById('testOutlineBtn');
  const statusSpan = document.getElementById('status');
  const animListSpan = document.getElementById('anim-list');
  const clickModeSpan = document.getElementById('click-mode');
  const clickHint = document.getElementById('click-hint');

  let animations = [];
  let outlineEffect = null;
  let pixelEffect = null;
  let isOutlineActive = false;
  let clickTimer = null;

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  function findEffects() {
    outlineEffect = document.getElementById('outlineEffect');
    pixelEffect = document.getElementById('pixelEffect');
    
    console.log('üîç Found effects:', { 
      outline: outlineEffect ? '‚úÖ' : '‚ùå', 
      pixel: pixelEffect ? '‚úÖ' : '‚ùå' 
    });
    
    // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –∫–æ–Ω—Ç—É—Ä, —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –æ–Ω –≤—ã–∫–ª—é—á–µ–Ω
    if (outlineEffect) {
      console.log('üé® Outline effect attributes:', {
        color: outlineEffect.color,
        strength: outlineEffect.strength,
        blendMode: outlineEffect.blendMode
      });
    }
    
    return outlineEffect || pixelEffect;
  }

  // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞ - –°–£–ü–ï–† –Ø–†–ö–ò–ô –í–ê–†–ò–ê–ù–¢
  function setOutline(active) {
    if (outlineEffect) {
      try {
        if (active) {
          // –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø —è—Ä–∫–æ—Å—Ç—å –∫–æ–Ω—Ç—É—Ä–∞
          outlineEffect.blendMode = 'screen';
          outlineEffect.strength = 10;
          outlineEffect.color = '#ff3300';
          outlineEffect.threshold = 0.005;
          
          isOutlineActive = true;
          outlineBtn.classList.add('active');
          console.log('üü† SUPER BRIGHT OUTLINE ENABLED');
          
          // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
          clickHint.style.background = '#00aa00';
          clickHint.innerHTML = '‚úÖ –ö–û–ù–¢–£–† –ê–ö–¢–ò–í–ò–†–û–í–ê–ù! –ö–ª–∏–∫–Ω–∏ –µ—â–µ —Ä–∞–∑';
          clickHint.style.animation = 'none';
          clickHint.style.transform = 'translateX(-50%) scale(1.1)';
          
          // –ú–µ–Ω—è–µ–º —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
          mv.style.backgroundColor = '#f0f0f0';
          
          clickModeSpan.innerHTML = '‚ú® –Ø–†–ö–ò–ô –ö–û–ù–¢–£–† –∞–∫—Ç–∏–≤–µ–Ω';
          
          setTimeout(() => {
            clickHint.style.transform = 'translateX(-50%) scale(1)';
          }, 200);
          
          // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
          if (clickTimer) clearTimeout(clickTimer);
          clickTimer = setTimeout(() => {
            clickHint.style.opacity = '0.7';
          }, 2000);
        } else {
          outlineEffect.blendMode = 'skip';
          isOutlineActive = false;
          outlineBtn.classList.remove('active');
          console.log('‚ö™ Outline DISABLED');
          
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π –≤–∏–¥
          clickHint.style.background = '#ff5500';
          clickHint.innerHTML = 'üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –Ø–†–ö–ò–ô –û–†–ê–ù–ñ–ï–í–´–ô –ö–û–ù–¢–£–†!';
          clickHint.style.animation = 'pulse 2s infinite';
          clickHint.style.opacity = '1';
          
          mv.style.backgroundColor = '#ffffff';
          
          clickModeSpan.innerHTML = 'üëÜ –ö–ª–∏–∫–Ω–∏ –ø–æ —Ä–æ–±–æ—Ç—É';
        }
      } catch (e) {
        console.error('Error toggling outline:', e);
        alert('–û—à–∏–±–∫–∞ –∫–æ–Ω—Ç—É—Ä–∞: ' + e.message);
      }
    } else {
      alert('–≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞
  function toggleOutline() {
    setOutline(!isOutlineActive);
  }

  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  mv.addEventListener('load', () => {
    console.log('‚úÖ Model loaded successfully');
    statusSpan.textContent = '–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
    statusSpan.style.color = '#00aa00';
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    try {
      animations = mv.availableAnimations || [];
      console.log('üìä Available animations:', animations);
      animListSpan.textContent = animations.join(', ');
      
      if (animations.length >= 1) {
        mv.animationName = animations[0];
        mv.play();
      }
    } catch (e) {
      console.error('Error getting animations:', e);
    }
    
    // –ò—â–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
    setTimeout(() => {
      findEffects();
      setOutline(false); // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –∫–æ–Ω—Ç—É—Ä –≤—ã–∫–ª—é—á–µ–Ω
      
      // –ü—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∞
      setTimeout(() => {
        if (outlineEffect) {
          console.log('üîß Testing outline - quick flash');
          outlineEffect.blendMode = 'screen';
          outlineEffect.strength = 10;
          setTimeout(() => {
            outlineEffect.blendMode = 'skip';
          }, 500);
        }
      }, 1000);
    }, 500);
  });

  mv.addEventListener('error', (error) => {
    console.error('‚ùå Model loading error:', error);
    statusSpan.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    statusSpan.style.color = '#ff0000';
  });

  // –ö–õ–ò–ö –ü–û –†–û–ë–û–¢–£
  mv.addEventListener('click', (event) => {
    console.log('üëÜ Robot clicked!');
    
    if (!outlineEffect) findEffects();
    toggleOutline();
    
    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
    mv.style.transform = 'scale(0.99)';
    setTimeout(() => {
      mv.style.transform = 'scale(1)';
    }, 100);
  });

  // –¢–ï–°–¢–û–í–ê–Ø –ö–ù–û–ü–ö–ê - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ç—É—Ä
  testOutlineBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    
    if (!outlineEffect) findEffects();
    
    if (outlineEffect) {
      // –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - –±—ã—Å—Ç—Ä–æ –º–∏–≥–∞–µ–º –∫–æ–Ω—Ç—É—Ä–æ–º
      alert('–¢–µ—Å—Ç –∫–æ–Ω—Ç—É—Ä–∞: —Å–µ–π—á–∞—Å –¥–æ–ª–∂–µ–Ω –º–∏–≥–Ω—É—Ç—å –æ—Ä–∞–Ω–∂–µ–≤—ã–π –∫–æ–Ω—Ç—É—Ä!');
      
      outlineEffect.blendMode = 'screen';
      outlineEffect.strength = 12;
      outlineEffect.color = '#ff0000';
      
      setTimeout(() => {
        outlineEffect.blendMode = 'skip';
      }, 1000);
    } else {
      alert('–≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 1
  btn1.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 1) {
      mv.animationName = animations[0];
      mv.currentTime = 0;
      mv.play();
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 2
  btn2.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 2) {
      mv.animationName = animations[1];
      mv.currentTime = 0;
      mv.play();
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Ç—É—Ä–∞
  outlineBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleOutline();
  });

  // –ö–Ω–æ–ø–∫–∞ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  pixelBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    
    if (!pixelEffect) findEffects();
    
    if (pixelEffect) {
      try {
        if (pixelEffect.blendMode === 'skip') {
          pixelEffect.blendMode = 'normal';
          pixelEffect.granularity = 10;
          pixelBtn.classList.add('active');
          console.log('üî≥ Pixelation ENABLED');
        } else {
          pixelEffect.blendMode = 'skip';
          pixelBtn.classList.remove('active');
          console.log('‚¨ú Pixelation DISABLED');
        }
      } catch (e) {
        console.error('Error toggling pixelation:', e);
      }
    }
  });

  // –ù–∞—Ö–æ–¥–∏–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  setTimeout(findEffects, 1000);

  // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  window.debugOutline = {
    on: () => setOutline(true),
    off: () => setOutline(false),
    toggle: toggleOutline,
    effect: () => outlineEffect
  };

})();
</script>

</body>
</html>
