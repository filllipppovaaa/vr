<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Robot Animations Control</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer-effects@1.2.0/dist/model-viewer-effects.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      overflow: hidden;
    }

    #controls {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(30, 30, 40, 0.9);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      color: white;
      backdrop-filter: blur(5px);
      border: 1px solid #444;
      pointer-events: none;
    }

    #controls h3 {
      margin: 0 0 15px 0;
      color: #ffaa00;
    }

    #controls button {
      pointer-events: auto;
    }

    #debug-info {
      margin-top: 15px;
      padding: 10px;
      background: #222;
      border-radius: 6px;
      font-size: 12px;
      border-left: 3px solid #ffaa00;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    button {
      margin: 0;
      padding: 10px 16px;
      cursor: pointer;
      background: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background: #444;
      border-color: #ffaa00;
    }

    button.active {
      background: #ffaa00;
      color: #222;
      border-color: #ffaa00;
    }

    #click-hint {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 170, 0, 0.9);
      color: #222;
      padding: 12px 24px;
      border-radius: 50px;
      font-weight: bold;
      z-index: 100;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      animation: pulse 2s infinite;
      border: 2px solid white;
    }

    @keyframes pulse {
      0% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.05); }
      100% { transform: translateX(-50%) scale(1); }
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #1a1a1a;
      cursor: pointer;
    }

    model-viewer:active {
      cursor: grabbing;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
    model-viewer.selected {
      outline: none;
    }
  </style>
</head>

<body>

<div id="controls">
  <h3>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º</h3>
  
  <div class="button-group">
    <button id="btn1">üé¨ –ê–Ω–∏–º–∞—Ü–∏—è 1 (–¢—Ä–µ–∫ –ù–õ–ê)</button>
    <button id="btn2">üö∂ –ê–Ω–∏–º–∞—Ü–∏—è 2 (holding_and_walk)</button>
  </div>
  
  <div class="button-group">
    <button id="outlineBtn">‚ú® –ö–æ–Ω—Ç—É—Ä (–≤–∫–ª/–≤—ã–∫–ª)</button>
    <button id="pixelBtn">üî≤ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
  </div>
  
  <div id="debug-info">
    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status" style="color: #ffaa00;">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
    <div><strong>–ê–Ω–∏–º–∞—Ü–∏–∏:</strong> <span id="anim-list">–¢—Ä–µ–∫ –ù–õ–ê, holding_and_walk</span></div>
    <div><strong>–†–µ–∂–∏–º:</strong> <span id="click-mode">üëÜ –ö–ª–∏–∫–Ω–∏ –ø–æ —Ä–æ–±–æ—Ç—É –¥–ª—è –∫–æ–Ω—Ç—É—Ä–∞</span></div>
  </div>
</div>

<div id="click-hint">
  üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–Ω—Ç—É—Ä!
</div>

<model-viewer
  id="mv"
  src="robot.glb"
  camera-controls
  autoplay
  animation-crossfade-duration="300"
  ar-status="not-present"
  loading="eager"
  reveal="auto"
  shadow-intensity="1"
  tone-mapping="aces"
  exposure="1.2"
  style="background-color: #1a1a1a;"
>

  <effect-composer multisampling="4">
    <!-- –≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ç—É—Ä–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω) -->
    <outline-effect
      id="outlineEffect"
      color="#ff6600"
      strength="3"
      threshold="0.1"
      blend-mode="skip"
    ></outline-effect>
    
    <!-- –≠—Ñ—Ñ–µ–∫—Ç –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏ -->
    <pixelate-effect
      id="pixelEffect"
      granularity="6"
      blend-mode="skip"
      opacity="0.9"
    ></pixelate-effect>
  </effect-composer>

  <!-- –û—Å–≤–µ—â–µ–Ω–∏–µ -->
  <environment-preset></environment-preset>
  <directional-light intensity="1.5" shadow-intensity="1"></directional-light>
  <ambient-light intensity="0.8"></ambient-light>

</model-viewer>

<script>
(() => {
  console.log('üöÄ Script started');
  
  const mv = document.getElementById('mv');
  const btn1 = document.getElementById('btn1');
  const btn2 = document.getElementById('btn2');
  const outlineBtn = document.getElementById('outlineBtn');
  const pixelBtn = document.getElementById('pixelBtn');
  const statusSpan = document.getElementById('status');
  const animListSpan = document.getElementById('anim-list');
  const clickModeSpan = document.getElementById('click-mode');
  const clickHint = document.getElementById('click-hint');

  let animations = [];
  let outlineEffect = null;
  let pixelEffect = null;
  let isOutlineActive = false;
  let clickTimer = null;

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  function findEffects() {
    outlineEffect = document.getElementById('outlineEffect');
    pixelEffect = document.getElementById('pixelEffect');
    
    console.log('üîç Found effects:', { 
      outline: outlineEffect ? '‚úÖ' : '‚ùå', 
      pixel: pixelEffect ? '‚úÖ' : '‚ùå' 
    });
    
    return outlineEffect || pixelEffect;
  }

  // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞
  function setOutline(active) {
    if (outlineEffect) {
      try {
        if (active) {
          outlineEffect.blendMode = 'additive';
          outlineEffect.strength = 3.5;
          outlineEffect.color = '#ff9900';
          isOutlineActive = true;
          outlineBtn.classList.add('active');
          console.log('üü† Outline ENABLED');
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
          clickHint.style.background = 'rgba(76, 175, 80, 0.9)';
          clickHint.innerHTML = '‚úÖ –ö–æ–Ω—Ç—É—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ö–ª–∏–∫–Ω–∏ –µ—â–µ —Ä–∞–∑ —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å';
          
          // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
          if (clickTimer) clearTimeout(clickTimer);
          clickTimer = setTimeout(() => {
            clickHint.style.opacity = '0';
            setTimeout(() => {
              clickHint.innerHTML = 'üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–Ω—Ç—É—Ä!';
              clickHint.style.background = 'rgba(255, 170, 0, 0.9)';
              clickHint.style.opacity = '1';
            }, 300);
          }, 3000);
        } else {
          outlineEffect.blendMode = 'skip';
          isOutlineActive = false;
          outlineBtn.classList.remove('active');
          console.log('‚ö™ Outline DISABLED');
          
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
          clickHint.style.background = 'rgba(255, 170, 0, 0.9)';
          clickHint.innerHTML = 'üëÜ –ö–õ–ò–ö–ù–ò –ü–û –†–û–ë–û–¢–£ - –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–Ω—Ç—É—Ä!';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ä–µ–∂–∏–º–∞
        clickModeSpan.innerHTML = active ? '‚ú® –ö–æ–Ω—Ç—É—Ä –∞–∫—Ç–∏–≤–µ–Ω (–∫–ª–∏–∫–Ω–∏ —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å)' : 'üëÜ –ö–ª–∏–∫–Ω–∏ –ø–æ —Ä–æ–±–æ—Ç—É –¥–ª—è –∫–æ–Ω—Ç—É—Ä–∞';
        
      } catch (e) {
        console.error('Error toggling outline:', e);
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞
  function toggleOutline() {
    if (outlineEffect) {
      setOutline(!isOutlineActive);
    }
  }

  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  mv.addEventListener('load', () => {
    console.log('‚úÖ Model loaded successfully');
    statusSpan.textContent = '–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
    statusSpan.style.color = '#00ff00';
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    try {
      animations = mv.availableAnimations || [];
      console.log('üìä Available animations:', animations);
      animListSpan.textContent = animations.join(', ');
      
      if (animations.length >= 1) {
        mv.animationName = animations[0];
        mv.play();
      }
    } catch (e) {
      console.error('Error getting animations:', e);
    }
    
    // –ò—â–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
    setTimeout(() => {
      findEffects();
      setOutline(false); // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –∫–æ–Ω—Ç—É—Ä –≤—ã–∫–ª—é—á–µ–Ω
    }, 500);
  });

  mv.addEventListener('error', (error) => {
    console.error('‚ùå Model loading error:', error);
    statusSpan.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    statusSpan.style.color = '#ff0000';
  });

  // –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–õ–ò–ö–ê –ü–û –†–û–ë–û–¢–£!
  mv.addEventListener('click', (event) => {
    console.log('üëÜ Robot clicked!');
    
    // –ù–∞—Ö–æ–¥–∏–º —ç—Ñ—Ñ–µ–∫—Ç—ã –µ—Å–ª–∏ –µ—â—ë –Ω–µ –Ω–∞—à–ª–∏
    if (!outlineEffect) findEffects();
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç—É—Ä
    toggleOutline();
    
    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
    mv.style.transform = 'scale(0.99)';
    setTimeout(() => {
      mv.style.transform = 'scale(1)';
    }, 100);
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 1
  btn1.addEventListener('click', (e) => {
    e.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ –∫–ª–∏–∫–∞
    if (animations.length >= 1) {
      mv.animationName = animations[0];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[0]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 2
  btn2.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 2) {
      mv.animationName = animations[1];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[1]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Ç—É—Ä–∞ (—Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
  outlineBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleOutline();
  });

  // –ö–Ω–æ–ø–∫–∞ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  pixelBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    
    if (!pixelEffect) findEffects();
    
    if (pixelEffect) {
      try {
        if (pixelEffect.blendMode === 'skip') {
          pixelEffect.blendMode = 'normal';
          pixelEffect.granularity = 8;
          pixelBtn.classList.add('active');
          console.log('üî≥ Pixelation ENABLED');
        } else {
          pixelEffect.blendMode = 'skip';
          pixelBtn.classList.remove('active');
          console.log('‚¨ú Pixelation DISABLED');
        }
      } catch (e) {
        console.error('Error toggling pixelation:', e);
      }
    }
  });

  // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∏
  let hintTimeout;
  document.addEventListener('mousemove', () => {
    clickHint.style.opacity = '1';
    clearTimeout(hintTimeout);
    hintTimeout = setTimeout(() => {
      if (!isOutlineActive) {
        clickHint.style.opacity = '0.5';
      }
    }, 3000);
  });

  // –ù–∞—Ö–æ–¥–∏–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  setTimeout(findEffects, 1000);

})();
</script>

</body>
</html>
