<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Robot</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º model-viewer -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.1/dist/es-module-shims.js"></script>
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@^0.172.0/build/three.module.min.js"
    }
  }
  </script>

  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer-module.min.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer-effects/dist/model-viewer-effects.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f7;
      overflow: hidden;
      touch-action: pan-y pinch-zoom;
    }

    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px 20px;
      border-radius: 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      backdrop-filter: blur(5px);
      border: 1px solid #e0e0e0;
      display: flex;
      gap: 10px;
      width: auto;
      max-width: 90vw;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    #controls::-webkit-scrollbar {
      display: none;
    }

    button {
      padding: 10px 18px;
      cursor: pointer;
      background: #ffffff;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 30px;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      white-space: nowrap;
      flex-shrink: 0;
      touch-action: manipulation;
    }

    button:active {
      background: #f0f0f0;
      transform: scale(0.95);
    }

    button.active {
      background: #ff5500;
      color: white;
      border-color: #ff5500;
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #ffffff;
      touch-action: pan-y pinch-zoom;
    }

    @media (max-width: 768px) {
      model-viewer {
        --progress-bar-height: 2px;
      }
    }
  </style>
</head>

<body>

<div id="controls">
  <button id="btn1">üé¨ –ê–Ω–∏–º–∞—Ü–∏—è 1</button>
  <button id="btn2">üö∂ –ê–Ω–∏–º–∞—Ü–∏—è 2</button>
  <button id="outlineBtn">‚ú® –ö–æ–Ω—Ç—É—Ä</button>
  <button id="pixelBtn">üî≥ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
</div>

<model-viewer
  id="mv"
  src="robot.glb"
  camera-controls
  autoplay
  animation-crossfade-duration="300"
  shadow-intensity="1"
  exposure="1"
  style="background-color: #ffffff;"
  camera-orbit="0deg 75deg 5m"
  min-camera-orbit="auto auto 2m"
  max-camera-orbit="auto auto 10m"
  interaction-prompt="none"
>

  <effect-composer id="composer">
    <outline-effect id="outlineEffect" color="red" blend-mode="skip"></outline-effect>
    <pixelate-effect id="pixelEffect" granularity="15" blend-mode="skip"></pixelate-effect>
  </effect-composer>

</model-viewer>

<script>
(() => {
  console.log('üöÄ Script started');
  
  const mv = document.getElementById('mv');
  const btn1 = document.getElementById('btn1');
  const btn2 = document.getElementById('btn2');
  const outlineBtn = document.getElementById('outlineBtn');
  const pixelBtn = document.getElementById('pixelBtn');

  const outlineEffect = document.getElementById('outlineEffect');
  const pixelEffect = document.getElementById('pixelEffect');

  let animations = [];
  let isOutlineActive = false;
  let isPixelActive = false;
  let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

  console.log('Effects found:', { outlineEffect, pixelEffect });
  console.log('Is mobile:', isMobile);

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞
  function toggleOutline() {
    if (outlineEffect) {
      if (isOutlineActive) {
        outlineEffect.setAttribute('blend-mode', 'skip');
        isOutlineActive = false;
        outlineBtn.classList.remove('active');
        console.log('üî¥ Outline OFF');
      } else {
        outlineEffect.setAttribute('blend-mode', 'default');
        isOutlineActive = true;
        outlineBtn.classList.add('active');
        console.log('üü¢ Outline ON');
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  function togglePixel() {
    if (pixelEffect) {
      if (isPixelActive) {
        pixelEffect.setAttribute('blend-mode', 'skip');
        isPixelActive = false;
        pixelBtn.classList.remove('active');
        pixelBtn.innerHTML = 'üî≥ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è';
        console.log('üì∑ Pixel OFF');
      } else {
        pixelEffect.setAttribute('blend-mode', 'default');
        pixelEffect.setAttribute('granularity', isMobile ? '20' : '15');
        isPixelActive = true;
        pixelBtn.classList.add('active');
        pixelBtn.innerHTML = '‚úÖ –ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è';
        console.log('üì∑ Pixel ON');
      }
    }
  }

  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  mv.addEventListener('load', () => {
    console.log('‚úÖ Model loaded successfully');
    
    // –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    try {
      animations = mv.availableAnimations || [];
      console.log('üìä Available animations:', animations);
      
      if (animations.length >= 1) {
        mv.animationName = animations[0];
        mv.play();
      }
    } catch (e) {
      console.error('Error getting animations:', e);
    }
  });

  mv.addEventListener('error', (error) => {
    console.error('‚ùå Model loading error:', error);
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 1
  btn1.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 1) {
      mv.animationName = animations[0];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[0]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ 2
  btn2.addEventListener('click', (e) => {
    e.stopPropagation();
    if (animations.length >= 2) {
      mv.animationName = animations[1];
      mv.currentTime = 0;
      mv.play();
      console.log('Playing animation:', animations[1]);
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Ç—É—Ä–∞
  outlineBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleOutline();
  });

  // –ö–Ω–æ–ø–∫–∞ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏
  pixelBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    togglePixel();
  });

  // –û—Ç–ª–∞–¥–∫–∞
  window.debug = {
    outlineOn: () => outlineEffect?.setAttribute('blend-mode', 'default'),
    outlineOff: () => outlineEffect?.setAttribute('blend-mode', 'skip'),
    pixelOn: () => {
      pixelEffect?.setAttribute('blend-mode', 'default');
      pixelEffect?.setAttribute('granularity', '20');
    },
    pixelOff: () => pixelEffect?.setAttribute('blend-mode', 'skip'),
    setPixelSize: (size) => pixelEffect?.setAttribute('granularity', size)
  };

})();
</script>

</body>
</html>
